# E2E Testing Configuration
# Usage:
#   tilt up -f Tiltfile.e2e
#   tilt up -f Tiltfile.e2e -- --namespace=my-e2e-ns
#
# Default namespace: buun-curator-e2e
# Access via Telepresence: http://buun-curator.<namespace>:3000
#
# This configuration adds Toxiproxy and Playwright for SSE connection testing.
#
# Architecture:
#   Browser/Playwright → Toxiproxy:8080 → Frontend:3000
#                              ↑
#                     Network fault injection
#
# Note: frontend.serverUrl and frontend.allowedDevOrigins are set dynamically
# by Tiltfile.e2e based on the --namespace parameter.

frontend:
  serverUrl: http://buun-curator.buun-curator:3000

  env:
    # Enable SSE debug UI for E2E testing
    - name: NEXT_PUBLIC_DEBUG_SSE
      value: "true"

  extraEnvVarsSecret: buun-curator-secret

worker:
  apiUrl: http://buun-curator.buun-curator:3000

  s3:
    endpoint: http://minio.minio:9000
    # accessKey and secretKey are set via extraEnvVarsSecret
    bucket: buun-curator-e2e
    prefix: public
    publicUrl: https://minio.buun.ai/buun-curator-e2e/public
    region: us-east-1

  translation:
    provider: microsoft

  extraEnvVarsSecret: buun-curator-secret

agent:
  extraEnvVarsSecret: buun-curator-secret

auth:
  enabled: false
  appUrl: http://buun-curator.buun-curator:3000

postgres:
  app:
    host: postgres-cluster-rw.postgres
    port: 5432
    username: buun_curator_e2e
    password: buun_curator_e2e
    database: buun_curator_e2e

temporal:
  host: temporal-frontend.temporal:7233
  namespace: buun-curator-e2e
  taskQueue: buun-curator-e2e

meilisearch:
  host: meilisearch.meilisearch:7700
  index: buun-curator-e2e

llm:
  baseUrl: http://litellm.litellm:4000
  apiKey: ""
  models:
    # Default model (fallback for all tasks)
    default: gemini-flash-lite
    # Task-specific models (if empty, falls back to default)
    # EXTRACTION: Requires Structured Output support
    extraction: gemini-3-flash
    # REASONING: Requires Structured Output support
    reasoning: gemini-3-flash
    # SUMMARIZATION: Any model works
    summarization: gemini-flash-lite
    # ASSISTANT: Frontend AI assistant model (falls back to default)
    assistant: gemini-3-flash
    # GRAPHRAG: Model for GraphRAG operations (entity extraction, etc.)
    graphRAG: gemini-flash-lite
    # AGENT: Agent service models
    agent:
      research: gemini-3-flash

evaluation:
  enabled: false

# E2E testing components
e2e:
  enabled: true

  # Toxiproxy - TCP proxy for network fault injection
  # https://github.com/Shopify/toxiproxy
  toxiproxy:
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

  # Playwright - Browser automation for E2E tests
  # https://playwright.dev/
  playwright:
    resources:
      limits:
        cpu: "2"
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi
