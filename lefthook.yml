# Lefthook configuration
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    # Markdown: fix tables -> lint
    lint-markdown:
      glob: "{*,**/*}.md"
      run: ./scripts/fix-md-tables {staged_files} && markdownlint-cli2 --fix {staged_files}
      stage_fixed: true

    # TypeScript/JavaScript: prettier -> eslint (sequential)
    lint-ts:
      glob: "*.{ts,tsx,js,jsx}"
      run: bun prettier --write {staged_files} && bun lint --fix {staged_files}
      stage_fixed: true

    # Python (worker): organize imports -> fix -> format (sequential)
    lint-python-worker:
      glob: "worker/**/*.py"
      root: "worker/"
      env:
        VIRTUAL_ENV: ".venv"
      run: |
        uv run ruff check --fix --force-exclude --select=I001 --exit-zero --no-cache {staged_files} &&
        uv run ruff check --fix --force-exclude --exit-zero --no-cache {staged_files} &&
        uv run ruff format --force-exclude {staged_files}
      stage_fixed: true

    # Python (agent): organize imports -> fix -> format (sequential)
    lint-python-agent:
      glob: "agent/**/*.py"
      root: "agent/"
      env:
        VIRTUAL_ENV: ".venv"
      run: |
        uv run ruff check --fix --force-exclude --select=I001 --exit-zero --no-cache {staged_files} &&
        uv run ruff check --fix --force-exclude --exit-zero --no-cache {staged_files} &&
        uv run ruff format --force-exclude {staged_files}
      stage_fixed: true

pre-push:
  parallel: true
  commands:
    test-ts:
      glob: "*.{ts,tsx,js,jsx}"
      run: bun test:unit:run

    test-python-worker:
      glob: "worker/**/*.py"
      root: "worker/"
      run: uv run pytest

    test-python-agent:
      glob: "agent/**/*.py"
      root: "agent/"
      run: uv run pytest
